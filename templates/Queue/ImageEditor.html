{HEADER}
<div class="row">
    <div class="col">
        <form id="Form3" action="/queue/image_editor/{BOOK_ID}" method="post" enctype="multipart/form-data">
            <div class="card mb-4 {DISPLAY_FORM}">
                <fieldset {FIELDSET_DISABLED}>
                <input type="hidden" name="pibn" value="{pibn}">
                <input type="hidden" name="isbn" value="{isbn}">
                <input type="hidden" name="title" value="{title}">
                <input type="hidden" name="subtitle" value="{subtitle}">
                <input type="hidden" name="author1" value="{author1}">
                <input type="hidden" name="author2" value="{author2}">
                <input type="hidden" name="volume" value="{volume}">
                <input type="hidden" name="volumes_total" value="{volumes_total}">
                <input type="hidden" name="word_count" value="{word_count}">
                <input type="hidden" name="images_number" value="{images_number}">
                <input type="hidden" name="pages_number" value="{pages_number}">
                <input type="hidden" name="missing_pages" value="{missing_pages}">
                <input type="hidden" name="blurb" value="{blurb}">
                <div class="card-body bg-light">
                    <div class="form-row {DISPLAY_PATHS}">
                        <div class="form-group flex-column">
                            <table class="table table-sm table-borderless">
                                <tr class="border-bottom border-info">
                                    <td class="align-middle text-right">Download source file:</td>
                                    <td class="mark lead">{PIBN}/Images/{ASSIGNEE_NAME}/To Do</td>
                                </tr>
                                <tr>
                                    <td class="align-middle text-right">Upload your copy:</td>
                                    <td class="mark lead">{PIBN}/Images/{ASSIGNEE_NAME}/In Progress</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-3">
                            <label for="Images_number">Number of Images</label>
                            <input name="images_number" id="Images_number" value="{images_number}" type="number" class="form-control">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col">
                            <label>Comments</label>
                            <div class="card card-body bg-light">
                                <ul class="list-group list-group-flush bg-light scroll">
                                    {BOOK_COMMENTS}
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col">
                            <label for="Comments">Add Comment</label>
                            <textarea name="comments" id="Comments" class="form-control" rows="3">{comments}</textarea>
                        </div>
                    </div>
                </div>
                <div class="card-footer {DISPLAY_SUBMIT}">
                    <div class="form-row">
                        <div class="form-group col-auto pt-2">
                            {SELECT_WORKER}
                        </div>
                        <div class="form-group col-sm-2 col-xl-2">
                            <button id="BookCompleted" class="btn btn-success mr-3">Book Completed</button>
                        </div>
                        <div class="form-group col-auto">
                            <button id="CoordinatorAttention" class="btn btn-outline-danger">Request Coordinator Attention</button>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-12">
                            Move file to: <span id="FilePath1" class="mark lead px-0"></span><span id="FilePathName" class="mark lead px-0"></span><span id="FilePath2" class="mark lead px-0"></span>
                        </div>
                    </div>
                </div>
                </fieldset>
            </div>
        </form>
    </div>
</div>

{AVAILABLE_BOOKS}

<script>
    $(document).ready(function() {
        var nextWorkerId = $('#Form3 input[name="requested_user"]').val();

        $('#RequestBook').on('click', function () {
            $.post('/queue/image_editor/', { request: {PIBN}, queue: 3 }).done(function(data) {
                location.assign('/queue/image_editor/');
            });
        });

        $('#BookCompleted').on('click', function (event) {
            event.preventDefault();
            $(this).data('clicked', true);
            $('#CoordinatorAttention').data('clicked', false);
            $('#Form3 input[name="too_many_errors"]').val('');
            $('#Form3 input[name="coordinator_attention"]').val('');
            submitForm(4);
        });

        $('#CoordinatorAttention').on('click', function (event) {
            event.preventDefault();
            $(this).data('clicked', true);
            $('#Form3 input[name="requested_user"]').val('');
            var input = $('<input>').attr('type', 'hidden').attr('name', 'coordinator_attention').val(1);
            $('#Form3').append(input);
            submitForm(9);
        });

        function submitForm(queue) {
            if (queue == 4) {
                $('#Form3 input[name="requested_user"]').val(nextWorkerId);
            }

            var input = $('<input>').attr('type', 'hidden').attr('name', 'next_queue').val(queue);
            $('#Form3').append(input);
            $('#Form3').submit();
        };

        $('#Form3').validate({
            ignore: [],
            rules: {
                comments: {
                    required: {
                        depends: function (element) {
                            return $('#CoordinatorAttention').data('clicked');
                        }
                    }
                },
                requested_user: {
                    required: {
                        depends: function (element) {
                            return $('#BookCompleted').data('clicked');
                        }
                    }
                }
            },
            messages: {
                comments: 'Please provide your comments',
                requested_user: 'No Worker available'
            }
        });

        var arrQueueFolder = [{QUEUE_FOLDER}];
        var folders = arrQueueFolder[4].split('|');
        $('#FilePath1').text({PIBN} + folders[0]);
        $('#FilePathName').text($('#InputWorker').text());
        $('#FilePath2').text(folders[1]);
    });
</script>